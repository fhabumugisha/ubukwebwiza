
apply plugin: 'java-library'
apply plugin: 'maven'
apply plugin: 'eclipse'
apply plugin: 'war'
apply plugin: 'com.bmuschko.tomcat'
if (!hasProperty('buildProfile')) ext.buildProfile = 'dev'
apply from: "gradle/profile-${buildProfile}.gradle"

buildscript {
  repositories {
	  mavenLocal()
	   jcenter()
	  maven { url "https://plugins.gradle.org/m2/" }
  }
  
  dependencies {
    classpath 'com.bmuschko:gradle-tomcat-plugin:2.4.2'
  }
}


group = 'com.buseni'
version = '2.0.1-SNAPSHOT'

description = """"""

sourceCompatibility = 1.8
targetCompatibility = 1.8
tasks.withType(JavaCompile) {
	options.encoding = 'UTF-8'
}

war {
    version = version
}
task explodedWar(type: Copy) {
    into "build/webapp"
    with war
}

war.dependsOn explodedWar

repositories {
        
     mavenCentral()
	maven { url "https://repo.spring.io/snapshot" }
	maven { url "https://repo.spring.io/milestone" }
}

sourceSets {
    generated {
        java {
            srcDir "$projectDir/generated/java"
        }
    }
}
sourceSets.generated.java.srcDirs = ['src/main/generated']
configurations {
    querydslapt
}

dependencies {
    compile group: 'net.coobird', name: 'thumbnailator', version:'0.4.8'
    compile group: 'org.imgscalr', name: 'imgscalr-lib', version:'4.2'
    compile group: 'org.hsqldb', name: 'hsqldb', version:'2.2.8'
    compile group: 'commons-fileupload', name: 'commons-fileupload', version:'1.3.1'
    compile group: 'commons-io', name: 'commons-io', version:'2.4'
    compile group: 'mysql', name: 'mysql-connector-java', version:'5.1.33'
    compile group: 'org.hibernate', name: 'hibernate-core', version:'4.3.11.Final'
    compile group: 'org.hibernate', name: 'hibernate-entitymanager', version:'4.3.11.Final'
    compile group: 'org.hibernate', name: 'hibernate-validator', version:'4.0.2.GA'
    compile group: 'org.hibernate', name: 'hibernate-envers', version:'4.3.11.Final'
    compile group: 'org.hibernate', name: 'hibernate-search-orm', version:'4.5.3.Final'
    compile group: 'javax.el', name: 'javax.el-api', version:'2.2.4'
    compile group: 'org.glassfish.web', name: 'javax.el', version:'2.2.4'
    compile group: 'org.springframework', name: 'spring-webmvc', version:'4.3.4.RELEASE'
    compile group: 'org.springframework', name: 'spring-core', version:'4.3.4.RELEASE'
    compile group: 'org.springframework.data', name: 'spring-data-jpa', version:'1.9.6.RELEASE'
    compile group: 'org.springframework', name: 'spring-tx', version:'4.3.4.RELEASE'
    compile group: 'org.springframework', name: 'spring-test', version:'4.3.4.RELEASE'
    compile group: 'org.springframework', name: 'spring-web', version:'4.3.4.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-web', version:'4.2.0.RELEASE'
    compile group: 'org.springframework.security', name: 'spring-security-config', version:'4.2.0.RELEASE'
    compile group: 'org.springframework', name: 'spring-context', version:'4.3.4.RELEASE'
    compile group: 'org.springframework', name: 'spring-context-support', version:'4.3.4.RELEASE'
    compile group: 'org.springframework', name: 'spring-aspects', version:'4.3.4.RELEASE'
    compile group: 'org.thymeleaf', name: 'thymeleaf', version:'3.0.5.RELEASE'
    compile group: 'org.thymeleaf', name: 'thymeleaf-spring4', version:'3.0.5.RELEASE'
    compile group: 'nz.net.ultraq.thymeleaf', name: 'thymeleaf-layout-dialect', version:'2.2.1'
    compile group: 'org.thymeleaf.extras', name: 'thymeleaf-extras-springsecurity4', version:'3.0.2.RELEASE'
    compile group: 'io.github.jpenren', name: 'thymeleaf-spring-data-dialect', version:'3.2.2'
    compile group: 'javax.servlet', name: 'jstl', version:'1.2'
    compile group: 'org.slf4j', name: 'slf4j-api', version:'1.7.7'
    compile group: 'org.slf4j', name: 'slf4j-log4j12', version:'1.7.7'
    compile group: 'com.h2database', name: 'h2', version:'1.4.180'
    compile group: 'com.mysema.querydsl', name: 'querydsl-jpa', version:'3.7.4'
    compile group: 'org.apache.commons', name: 'commons-lang3', version:'3.3.2'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version:'2.5.1'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version:'2.5.1'
    compile group: 'org.codehaus.jackson', name: 'jackson-core-asl', version:'1.9.13'
    compile group: 'org.codehaus.jackson', name: 'jackson-mapper-asl', version:'1.9.13'
    compile group: 'net.sf.ehcache', name: 'ehcache', version:'2.9.0'
    compile group: 'com.amazonaws', name: 'aws-java-sdk-s3', version:'1.9.37'
    compile group: 'javax.mail', name: 'mail', version:'1.4.7'
    compile group: 'org.passay', name: 'passay', version:'1.0'
    compile group: 'org.aspectj', name: 'aspectjweaver', version:'1.8.5'
    compile group: 'org.apache.commons', name: 'commons-collections4', version:'4.0'
    compile group: 'org.quartz-scheduler', name: 'quartz', version:'2.2.1'
    compile group: 'com.twilio.sdk', name: 'twilio-java-sdk', version:'5.10.0'
    testCompile group: 'junit', name: 'junit', version:'4.12'
  
    compile group: 'javax.servlet', name: 'javax.servlet-api', version:'3.0.1'
    compile group: 'javax.servlet.jsp', name: 'jsp-api', version:'2.1'
    compile group: 'com.mysema.querydsl', name: 'querydsl-apt', version:'3.7.4'
    
    def tomcatVersion = '8.5.16'
    tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
           "org.apache.tomcat.embed:tomcat-embed-logging-juli:8.5.2",
           "org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}"
}

tomcat {
    httpProtocol = 'org.apache.coyote.http11.Http11Nio2Protocol'
    ajpProtocol  = 'org.apache.coyote.ajp.AjpNio2Protocol'
}
task generateQueryDSL(type: JavaCompile, group: 'build', description: 'Generates the QueryDSL query types') {
    source = sourceSets.main.java
    classpath = configurations.compile + configurations.querydslapt
    options.compilerArgs = [
            "-proc:only",
            "-processor", "com.mysema.query.apt.jpa.JPAAnnotationProcessor"
    ]
    destinationDir = sourceSets.generated.java.srcDirs.iterator().next()
}

compileJava {
    dependsOn generateQueryDSL
    source generateQueryDSL.destinationDir
}

compileGeneratedJava {
    dependsOn generateQueryDSL
    classpath += sourceSets.main.runtimeClasspath
}
